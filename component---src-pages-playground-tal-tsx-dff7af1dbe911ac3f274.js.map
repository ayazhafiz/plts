{"version":3,"file":"component---src-pages-playground-tal-tsx-dff7af1dbe911ac3f274.js","mappings":"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","sources":["webpack://www/./src/common/syntax/asm.ts","webpack://www/./src/pages/playground/tal.tsx"],"sourcesContent":["// Stolen from:\n// https://github.com/compiler-explorer/compiler-explorer/blob/9904a6ee51f765e9d37c7df9ee543ad834f51239/static/modes/asm-mode.ts\n//\n// Copyright (c) 2012, Compiler Explorer Authors\n// All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are met:\n//\n//     * Redistributions of source code must retain the above copyright notice,\n//       this list of conditions and the following disclaimer.\n//     * Redistributions in binary form must reproduce the above copyright\n//       notice, this list of conditions and the following disclaimer in the\n//       documentation and/or other materials provided with the distribution.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n// AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n// ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n// LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n// CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n// SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n// INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n// CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n// ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n// POSSIBILITY OF SUCH DAMAGE.\n\nimport type * as monaco from 'monaco-editor';\n\nexport const ASM_SYNTAX: monaco.languages.IMonarchLanguage = {\n    // Set defaultToken to invalid to see what you do not tokenize yet\n    defaultToken: 'invalid',\n\n    // C# style strings\n    escapes:\n        /\\\\(?:[abfnrtv\\\\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,\n\n    registers:\n        /%?\\b(r[0-9]+[dbw]?|([er]?([abcd][xhl]|cs|fs|ds|ss|sp|bp|ip|sil?|dil?))|[xyz]mm[0-9]+|sp|fp|lr)\\b/,\n\n    intelOperators: /PTR|(D|Q|[XYZ]MM)?WORD/,\n\n    tokenizer: {\n        root: [\n            // Error document\n            [/^<.*>$/, {token: 'annotation'}],\n            // Label definition\n            [/^[.a-zA-Z0-9_$?@].*:/, {token: 'type.identifier'}],\n            // Label definition (quoted)\n            [/^\"([^\"\\\\]|\\\\.)*\":/, {token: 'type.identifier'}],\n            // Label definition (ARM style)\n            [/^\\s*[|][^|]*[|]/, {token: 'type.identifier'}],\n            // Label definition (CL style)\n            [\n                /^\\s*[.a-zA-Z0-9_$|]*\\s+(PROC|ENDP|DB|DD)/,\n                {token: 'type.identifier'}\n            ],\n            // Constant definition\n            [/^[.a-zA-Z0-9_$?@][^=]*=/, {token: 'type.identifier'}],\n            // opcode\n            [/[.a-zA-Z_][.a-zA-Z_0-9]*/, {token: 'keyword', next: '@rest'}],\n            // braces and parentheses at the start of the line (e.g. nvcc\n            // output)\n            [/[(){}]/, {token: 'operator', next: '@rest'}],\n\n            // whitespace\n            {include: '@whitespace'},\n        ],\n\n        rest: [\n            // pop at the beginning of the next line and rematch\n            [/^.*$/, {token: '@rematch', next: '@pop'}],\n\n            [/@registers/, 'variable.predefined'],\n            [/@intelOperators/, 'annotation'],\n            // brackets\n            [/[{}<>()[\\]]/, '@brackets'],\n\n            // ARM-style label reference\n            [/[|][^|]*[|]*/, 'type.identifier'],\n\n            // numbers\n            [/\\d*\\.\\d+([eE][-+]?\\d+)?/, 'number.float'],\n            [/([$]|0[xX])[0-9a-fA-F]+/, 'number.hex'],\n            [/\\d+/, 'number'],\n            // ARM-style immediate numbers (which otherwise look like\n            // comments)\n            [/#-?\\d+/, 'number'],\n\n            // operators\n            [/[-+,*/!:&{}()]/, 'operator'],\n\n            // strings\n            [/\"([^\"\\\\]|\\\\.)*$/, 'string.invalid'],  // non-terminated string\n            [/\"/, {token: 'string.quote', bracket: '@open', next: '@string'}],\n\n            // characters\n            [/'[^\\\\']'/, 'string'],\n            [/(')(@escapes)(')/, ['string', 'string.escape', 'string']],\n            [/'/, 'string.invalid'],\n\n            // Assume anything else is a label reference\n            [/%?[.?_$a-zA-Z@][.?_$a-zA-Z0-9@]*/, 'type.identifier'],\n\n            // whitespace\n            {include: '@whitespace'},\n        ],\n\n        comment: [\n            [/[^/*]+/, 'comment'],\n            [/\\/\\*/, 'comment', '@push'],  // nested comment\n            ['\\\\*/', 'comment', '@pop'],\n            [/[/*]/, 'comment'],\n        ],\n\n        string: [\n            [/[^\\\\\"]+/, 'string'],\n            [/@escapes/, 'string.escape'],\n            [/\\\\./, 'string.escape.invalid'],\n            [/\"/, {token: 'string.quote', bracket: '@close', next: '@pop'}],\n        ],\n\n        whitespace: [\n            [/[ \\t\\r\\n]+/, 'white'],\n            [/\\/\\*/, 'comment', '@comment'],\n            [/\\/\\/.*$/, 'comment'],\n            [/[#;\\\\@].*$/, 'comment'],\n        ],\n    },\n};\n","import type * as monaco from \"monaco-editor\";\nimport * as React from \"react\";\nimport Playground from \"../../components/playground\";\nimport type { Backend } from \"../../common/types\";\nimport { promisify } from \"../../common/util\";\nimport { ASM_SYNTAX } from \"../../common/syntax/asm\";\nimport * as tal from \"tal\";\nimport ReactMarkdown from \"react-markdown\";\n\nconst examples = {\n  Fibonacci: `\nlet $fib =\n  (fix fib (n: int): int.\n    if0 n then 0\n    else if0 (n - 1) then 1   # n = 1\n    else fib (n - 1) + fib (n - 2)) in\nlet $twice =\n  (Λa. fix inf(f: a->a): a->a.\n       fix inx(x: a): a.\n         f (f x)) in\nlet $double =\n  (fix double(n: int): int.\n    ($twice<int>) (fix inx(x: int): int. x + n) 0) in\n$double ($fib 8)\n`.trim(),\n};\n\nconst backends: {\n  [K in \"TAL\" | \"x86\"]: [Backend, Backend];\n} = {\n  TAL: [\n    {\n      title: \"TAL\",\n      do: promisify(tal.talCompile),\n      options: [],\n      editorLanguage: \"tal\",\n    },\n    {\n      title: \"TAL Execution\",\n      do: promisify(tal.talEval),\n      options: [],\n      editorLanguage: \"tal\",\n    },\n  ],\n  x86: [\n    {\n      title: \"x86\",\n      do: promisify(tal.x86Compile),\n      options: [],\n      info: [\n        [\n          \"Codegen info\",\n          <ReactMarkdown\n            children={`\nRegister allocation is based on the [Linear Scan Register Allocation](http://web.cs.ucla.edu/~palsberg/course/cs132/linearscan.pdf)\nof Poletto and Sarkar (1999). We number instructions as they appear in the TAL\nIR, not in the order they would execute.\n\nThis poor ordering is simple to implement but results in many spills, as\ncan be seen in the generated code. The large number of spills demands multiple\npasses of register allocation, slowing down compilation time.\n\nSpilled variables live at the very top of the stack, with space allocated for\nthem before any code is executed.\n`.trim()}\n          />,\n        ],\n      ],\n      editorLanguage: \"asm\",\n    },\n    {\n      title: \"x86 Emulation\",\n      do: promisify(tal.x86Emulate),\n      options: [],\n      editorLanguage: \"tal\",\n    },\n  ],\n};\n\nconst talSyntax: monaco.languages.IMonarchLanguage = {\n  defaultToken: \"invalid\",\n\n  registers: /%?\\b(r[0-9a-z]+)\\b/,\n\n  keywords: [\"pack\", \"code\", \"halt\", \"as\"],\n\n  tokenizer: {\n    root: [\n      // Error document\n      [/^<.*>$/, { token: \"annotation\" }],\n      // Label definition\n      [/^[.a-zA-Z0-9_$?@].*:/, { token: \"type.identifier\" }],\n      // Constant definition\n      [/^[.a-zA-Z0-9_$?@][^=]*=/, { token: \"type.identifier\" }],\n      // opcode\n      [/[.a-zA-Z_][.a-zA-Z_0-9']*/, { token: \"keyword\", next: \"@rest\" }],\n      [/[(){}\\[\\]\\-<>]/, { token: \"operator\", next: \"@rest\" }],\n      [/\\d+/, \"number\"],\n\n      // whitespace\n      { include: \"@whitespace\" },\n    ],\n\n    rest: [\n      // pop at the beginning of the next line and rematch\n      [/^.*$/, { token: \"@rematch\", next: \"@pop\" }],\n\n      [/@registers/, \"variable.predefined\"],\n\n      [/\\d+/, \"number\"],\n\n      [/[,\\(\\):,\\[\\]\\-<>∃∀+]/, \"operator\"],\n      // Assume anything else is a label reference\n      [\n        /%?[.?_$a-zA-Z@][.?_$a-zA-Z0-9'@]*/,\n        { cases: { \"@keywords\": \"keyword\", \"@default\": \"type.identifier\" } },\n      ],\n\n      // whitespace\n      { include: \"@whitespace\" },\n    ],\n\n    comment: [\n      [/[^/*]+/, \"comment\"],\n      [/\\/\\*/, \"comment\", \"@push\"], // nested comment\n      [\"\\\\*/\", \"comment\", \"@pop\"],\n      [/[/*]/, \"comment\"],\n    ],\n\n    whitespace: [\n      [/[ \\t\\r\\n]+/, \"white\"],\n      [/\\/\\*/, \"comment\", \"@comment\"],\n      [/\\/\\/.*$/, \"comment\"],\n      [/[#;\\\\@].*$/, \"comment\"],\n    ],\n  },\n};\n\nconst systemFSyntax: monaco.languages.IMonarchLanguage = {\n  defaultToken: \"invalid\",\n  keywords: [\"fix\", \"if0\", \"then\", \"else\", \"Λ\", \"let\", \"in\"],\n\n  typeKeywords: [\"int\", \"∀\"],\n\n  symbols: /[=><!~?:&|+\\-*\\/\\^%.,]+/,\n  tokenizer: {\n    root: [\n      [\n        /[a-z_A-Z][\\w0-9$]*|[∀Λ]/,\n        {\n          cases: {\n            \"@typeKeywords\": \"keyword\",\n            \"@keywords\": \"keyword\",\n            \"@default\": \"identifier\",\n          },\n        },\n      ],\n      { include: \"@whitespace\" },\n      [/[{}()\\[\\]]/, \"@brackets\"],\n\n      [/[%$][a-z_A-Z0-9]*/, \"annotation\"],\n      [/@symbols/, \"operator\"],\n      // numbers\n      [/\\d+/, \"number\"],\n    ],\n    whitespace: [\n      [/[ \\t\\r\\n]+/, \"white\"],\n      [/(^#.*$)/, \"comment\"],\n    ],\n  },\n};\n\nconst languages = {\n  systemF: {\n    syntax: systemFSyntax,\n  },\n  tal: {\n    syntax: talSyntax,\n  },\n  asm: {\n    syntax: ASM_SYNTAX,\n  },\n};\n\nconst FtPlayground = () => (\n  <Playground\n    title=\"TAL Playground\"\n    language=\"systemF\"\n    source=\"https://github.com/ayazhafiz/plts/tree/base/TAL\"\n    grammar=\"https://github.com/ayazhafiz/plts/blob/base/TAL/parser.mly\"\n    languageRegistrations={languages}\n    backends={backends}\n    defaultBackend=\"TAL\"\n    examples={examples}\n    defaultExample=\"Fibonacci\"\n  />\n);\nexport default FtPlayground;\n"],"names":["ASM_SYNTAX","defaultToken","escapes","registers","intelOperators","tokenizer","root","token","next","include","rest","bracket","comment","string","whitespace","examples","Fibonacci","backends","TAL","title","do","promisify","tal","options","editorLanguage","x86","info","children","languages","systemF","syntax","keywords","typeKeywords","symbols","cases","asm","language","source","grammar","languageRegistrations","defaultBackend","defaultExample"],"sourceRoot":""}